---
import { getCollection } from "astro:content";
import { languages } from "../../i18n/ui";
import BaseLayout from "../../layouts/BaseLayout.astro";
import {
    getLangFromUrl,
    sortByYear,
    useCountryTranslations,
    useTranslations,
} from "../../i18n/utils";
import { YouTube } from "@astro-community/astro-embed-youtube";
import EventTypeTag from "../../components/EventTypeTag.astro";
import { getRelativeLocaleUrl } from "astro:i18n";

export async function getStaticPaths() {
    return Object.keys(languages).map((lang) => {
        return { params: { lang }, props: lang };
    });
}

const events = (
    await getCollection("events", ({ data }) => {
        return data.video;
    })
).sort(sortByYear);

const lang = getLangFromUrl(Astro.url);
const translateCountry = useCountryTranslations(lang);

const t = useTranslations(lang);
---

<BaseLayout title={t("nav.recordings")}>
    <div class="grid lg:grid-cols-3 gap-8">
        {
            events.map((event) => {
                if (event.data.video)
                    return (
                        <div class="">
                            <YouTube id={event.data.video} posterQuality="high" />
                            <a
                                href={getRelativeLocaleUrl(
                                    lang,
                                    `events/${event.id}`,
                                )}
                            >
                                <EventTypeTag>
                                    {t(event.data.eventType)}
                                </EventTypeTag>
                                <h3 class="text-xl -mt-[3pt]">
                                    {event.data.title}
                                </h3>
                                {event.data.author}
                                {event.data.affiliation && event.data.country
                                    ? `(${event.data.affiliation}, ${translateCountry(event.data.country) || event.data.country})`
                                    : ""}
                                <div class="text-sm">
                                    {event.data.dates[0].date}
                                    {event.data.dates.length > 1 &&
                                        ` - ${event.data.dates[event.data.dates.length - 1].date}`}
                                </div>
                            </a>
                        </div>
                    );
            })
        }
    </div>
</BaseLayout>
